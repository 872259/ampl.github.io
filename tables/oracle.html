

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Connecting AMPL to Oracle &mdash; AMPL Modeling Language for Mathematical Programming</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '20121105',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="AMPL Modeling Language for Mathematical Programming" href="../index.html" />
    <link rel="up" title="Database and spreadsheet connection guide" href="index.html" />
    <link rel="next" title="Connecting AMPL to SQL Server" href="sqlserver.html" />
    <link rel="prev" title="Connecting AMPL to MySQL" href="mysql.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sqlserver.html" title="Connecting AMPL to SQL Server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mysql.html" title="Connecting AMPL to MySQL"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">AMPL</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Database and spreadsheet connection guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Connecting AMPL to Oracle</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#gnu-linux">GNU/Linux</a><ul>
<li><a class="reference internal" href="#debian-based-distributions">Debian-based distributions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows">Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#data-source-name-not-found">Data source name not found</a></li>
<li><a class="reference internal" href="#driver-s-sqlallochandle-on-sql-handle-henv-failed">Driver&#8217;s SQLAllocHandle on SQL_HANDLE_HENV failed</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mysql.html"
                        title="previous chapter">Connecting AMPL to MySQL</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sqlserver.html"
                        title="next chapter">Connecting AMPL to SQL Server</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="connecting-ampl-to-oracle">
<span id="index-0"></span><h1>Connecting AMPL to Oracle<a class="headerlink" href="#connecting-ampl-to-oracle" title="Permalink to this headline">¶</a></h1>
<p>To use Oracle with AMPL, you need to have the <a class="reference external" href="http://www.oracle.com/technetwork/database/windows/index-098976.html">Oracle ODBC driver</a>
installed and to have access to a database server, which could be either
local or remote.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gnu-linux">
<h3>GNU/Linux<a class="headerlink" href="#gnu-linux" title="Permalink to this headline">¶</a></h3>
<div class="section" id="debian-based-distributions">
<h4>Debian-based distributions<a class="headerlink" href="#debian-based-distributions" title="Permalink to this headline">¶</a></h4>
<p>The following instructions apply to <a class="reference external" href="http://www.debian.org/">Debian</a>
and Debian-based Linux distributions such as <a class="reference external" href="http://www.ubuntu.com/">Ubuntu</a> and <a class="reference external" href="http://linuxmint.com/">Mint</a>.</p>
<ol class="arabic">
<li><p class="first">Download RPM packages of Oracle Instant Client for your Linux platform from the
<a class="reference external" href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html">Instant Client Downloads page</a>.
You will need Basic and ODBC packages. In the Usage example we also use <tt class="docutils literal"><span class="pre">sqlplus</span></tt> from
the SQL*Plus package.</p>
</li>
<li><p class="first">Convert packages from RPM to DEB format:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo alien oracle-instantclient*.rpm
</pre></div>
</div>
</li>
<li><p class="first">Install the packages:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo dpkg -i oracle-instantclient*.deb
</pre></div>
</div>
</li>
<li><p class="first">Install dependencies:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install libaio1 unixodbc
</pre></div>
</div>
</li>
<li><p class="first">Add the Oracle library directory to the library search paths:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">echo</span> /usr/lib/oracle/*/client*/lib | sudo tee -a /etc/ld.so.conf
sudo ldconfig
</pre></div>
</div>
</li>
<li><p class="first">Register the ODBC driver:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo /usr/share/oracle/*/client*/odbc_update_ini.sh / /usr/lib/oracle/*/client*/lib
</pre></div>
</div>
</li>
<li><p class="first">Create a symbolic link for <tt class="docutils literal"><span class="pre">libodbcinst.so</span></tt> on <tt class="docutils literal"><span class="pre">x86-64</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo ln -s /usr/lib/x86_64-linux-gnu/libodbcinst.so <span class="se">\</span>
           /usr/lib/x86_64-linux-gnu/libodbcinst.so.2
</pre></div>
</div>
<p>Use the following command with the <tt class="docutils literal"><span class="pre">x86</span></tt> version instead:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo ln -s /usr/lib/libodbcinst.so /usr/lib/libodbcinst.so.2
</pre></div>
</div>
</li>
<li><p class="first">Set the <tt class="docutils literal"><span class="pre">ORACLE_HOME</span></tt> environment variable:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">ORACLE_HOME</span><span class="o">=</span>&lt;installation-dir&gt;
</pre></div>
</div>
<p>replacing <tt class="docutils literal"><span class="pre">&lt;installation-dir&gt;</span></tt> with the actual installation directory which can
be printed with the command <tt class="docutils literal"><span class="pre">echo</span> <span class="pre">/usr/lib/oracle/*/client*</span></tt>.</p>
<p>Alternatively you can add the line <tt class="docutils literal"><span class="pre">ORACLE_HOME=&lt;installation-dir&gt;</span></tt> to
<tt class="docutils literal"><span class="pre">~/.pam_environment</span></tt> to set this environment variable permanently for
the current user. Use <tt class="docutils literal"><span class="pre">/etc/environment</span></tt> instead of <tt class="docutils literal"><span class="pre">~/.pam_environment</span></tt>
for system-wide environment variables.
See also <a class="reference external" href="https://help.ubuntu.com/community/EnvironmentVariables#Persistent_environment_variables">Persistent environment variables</a>.</p>
</li>
</ol>
<p>Go to <a class="reference internal" href="#oracle-usage"><em>Usage</em></a>.</p>
</div>
</div>
<div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>The ODBC driver for Oracle often comes installed by default on modern versions
of Windows. You can check if the driver is installed by running the ODBC Data Source
Administrator, <tt class="docutils literal"><span class="pre">odbcad32.exe</span></tt>, and looking for Oracle in the <tt class="docutils literal"><span class="pre">Drivers</span></tt> tab.</p>
<img alt="../_images/odbcad32-oracle.png" src="../_images/odbcad32-oracle.png" />
<p>If the driver is missing, download one from <a class="reference external" href="http://www.oracle.com/technetwork/database/windows/downloads/index-096177.html">OracleODBC Drivers Download Page</a>
and install it.</p>
</div>
</div>
<div class="section" id="usage">
<span id="oracle-usage"></span><h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll demonstrate usage of Oracle with AMPL on a small example.
For this example we use the diet problem, which finds a combination of foods
that satisfies certain nutritional requirements. It is described in
<a class="reference external" href="http://www.ampl.com/BOOK/CHAPTERS/05-tut2.pdf">Chapter 2 of the AMPL book</a>.</p>
<p>We assume that you&#8217;ve already installed the Oracle ODBC driver using
the instructions above and have access to a local Oracle database.</p>
<p>First download the data for the diet problem <a class="reference external" href="http://ampl.github.io/models/tables/diet-oracle.sql">diet-oracle.sql</a>
and import it into an Oracle database:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sqlplus &lt;username&gt;/&lt;password&gt; @diet-oracle.sql
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;username&gt;</span></tt> is the name of a database user and <tt class="docutils literal"><span class="pre">&lt;password&gt;</span></tt> is the
user&#8217;s password.</p>
<p>Then download the model file <a class="reference external" href="http://ampl.github.io/models/tables/diet.mod">diet.mod</a>
and the script file <a class="reference external" href="http://ampl.github.io/models/tables/diet-oracle.run">diet-oracle.run</a>.</p>
<p>The script file first reads the model:</p>
<div class="highlight-none"><div class="highlight"><pre>model diet.mod;
</pre></div>
</div>
<p>Then it defines a parameter to hold a connection string. Since the connection
parameters are the same for all table declarations in our example, we
avoid unnecessary duplication. In this case we specify all the connection
parameters explicitly. Alternatively, you could use a DSN file name or
<tt class="docutils literal"><span class="pre">&quot;DSN=&lt;dsn-name&gt;&quot;</span></tt> as a connection string.</p>
<div class="highlight-none"><div class="highlight"><pre>param ConnectionStr symbolic = &quot;DRIVER=Oracle; SERVER=localhost;&quot;;
</pre></div>
</div>
<p>If you are using Linux or MacOS X and have chosen a driver name other
than <tt class="docutils literal"><span class="pre">Oracle</span></tt>, you will have to specify this name instead of <tt class="docutils literal"><span class="pre">Oracle</span></tt>
in the <tt class="docutils literal"><span class="pre">DRIVER=Oracle</span></tt> attribute in the connection string.</p>
<p>A driver name is chosen automatically during installation on Windows,
so if you are using this OS, you will have to find the driver name and
specify it instead of <tt class="docutils literal"><span class="pre">Oracle</span></tt> in the connection string.
To discover the driver name on Windows, run the ODBC Data Source
Administrator, <tt class="docutils literal"><span class="pre">odbcad32.exe</span></tt>.  Go to the <tt class="docutils literal"><span class="pre">Drivers</span></tt> tab where all the
installed drivers are listed and look for the one containing <tt class="docutils literal"><span class="pre">Oracle</span></tt>:</p>
<img alt="../_images/odbcad32-oracle.png" src="../_images/odbcad32-oracle.png" />
<p>A driver name containing a semicolon (<tt class="docutils literal"><span class="pre">;</span></tt>) should be surrounded with
<tt class="docutils literal"><span class="pre">{</span></tt> and <tt class="docutils literal"><span class="pre">}</span></tt> in a connection string, for example:</p>
<div class="highlight-none"><div class="highlight"><pre>param ConnectionStr symbolic =
  &quot;DRIVER={Oracle ODBC Driver; version 6.01}; SERVER=localhost;&quot;;
</pre></div>
</div>
<p>Next there are several table declarations that use the <tt class="docutils literal"><span class="pre">ConnectionStr</span></tt>
parameter defined previously:</p>
<div class="highlight-none"><div class="highlight"><pre>table dietFoods &quot;ODBC&quot; (ConnectionStr) &quot;Foods&quot;:
    FOOD &lt;- [FOOD], cost IN, f_min IN, f_max IN,
    Buy OUT, Buy.rc ~ BuyRC OUT, {j in FOOD} Buy[j]/f_max[j] ~ BuyFrac;

table dietNutrs IN &quot;ODBC&quot; (ConnectionStr) &quot;Nutrients&quot;: NUTR &lt;- [NUTR], n_min, n_max;
table dietAmts IN &quot;ODBC&quot; (ConnectionStr) &quot;Amounts&quot;: [NUTR, FOOD], amt;
</pre></div>
</div>
<p>Finally the script reads the data from the tables</p>
<div class="highlight-none"><div class="highlight"><pre>read table dietFoods;
read table dietNutrs;
read table dietAmts;
</pre></div>
</div>
<p>solves the problem</p>
<div class="highlight-none"><div class="highlight"><pre>solve;
</pre></div>
</div>
<p>and writes the solution back to the database:</p>
<div class="highlight-none"><div class="highlight"><pre>write table dietFoods;
</pre></div>
</div>
<p>Note that the same table <tt class="docutils literal"><span class="pre">dietFoods</span></tt> is used both for input and output.</p>
<p>Running the <tt class="docutils literal"><span class="pre">diet-oracle.run</span></tt> script with ampl shows that data connection
is working properly and the problem is easily solved:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ampl diet-oracle.run
MINOS 5.51: optimal solution found.
13 iterations, objective 118.0594032
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>This section lists common problems with possible solutions.</p>
<p>The first thing to do in case of an error is to get additional information.
Add the option <tt class="docutils literal"><span class="pre">&quot;verbose&quot;</span></tt> to the table declaration that causes the error,
for example:</p>
<div class="highlight-none"><div class="highlight"><pre>table dietFoods &quot;ODBC&quot; (ConnectionStr) &quot;Foods&quot; &quot;verbose&quot;:
  ...
</pre></div>
</div>
<p>Then rerun your code and you should get a more detailed error message.</p>
<div class="section" id="data-source-name-not-found">
<h3>Data source name not found<a class="headerlink" href="#data-source-name-not-found" title="Permalink to this headline">¶</a></h3>
<p>Verbose error:</p>
<div class="highlight-none"><div class="highlight"><pre>SQLDriverConnect returned -1
sqlstate = &quot;IM002&quot;
errmsg = &quot;[unixODBC][Driver Manager]Data source name not found, and no default driver specified&quot;
native_errno = 0
</pre></div>
</div>
<p>If the data source name (DSN) was not found as in the example above check
if it is spelled correctly in the connection string. If you are not using a
DSN, check the driver name instead. On a Unix-based system you can get the
list of installed ODBC drivers using  the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>odbcinst -d -q
</pre></div>
</div>
<p>On Windows use the ODBC Data Source Administrator (see <a class="reference internal" href="#oracle-usage"><em>Usage</em></a>).</p>
<p>If the driver name contains a semicolon (<tt class="docutils literal"><span class="pre">;</span></tt>), check that the name is
surrounded with <tt class="docutils literal"><span class="pre">{</span></tt> and <tt class="docutils literal"><span class="pre">}</span></tt> in the connection string, for example:</p>
<div class="highlight-none"><div class="highlight"><pre>table Foods &quot;ODBC&quot; &quot;DRIVER={Oracle ODBC Driver; version 6.01}; DATABASE=test;&quot;:
  ...
</pre></div>
</div>
</div>
<div class="section" id="driver-s-sqlallochandle-on-sql-handle-henv-failed">
<h3>Driver&#8217;s SQLAllocHandle on SQL_HANDLE_HENV failed<a class="headerlink" href="#driver-s-sqlallochandle-on-sql-handle-henv-failed" title="Permalink to this headline">¶</a></h3>
<p>Verbose error:</p>
<div class="highlight-none"><div class="highlight"><pre>SQLDriverConnect returned -1
sqlstate = &quot;IM004&quot;
errmsg = &quot;[unixODBC][Driver Manager]Driver&#39;s SQLAllocHandle on SQL_HANDLE_HENV failed&quot;
native_errno = 0
</pre></div>
</div>
<p>This error may occur if the <tt class="docutils literal"><span class="pre">ORACLE_HOME</span></tt> environment variable is not set.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sqlserver.html" title="Connecting AMPL to SQL Server"
             >next</a> |</li>
        <li class="right" >
          <a href="mysql.html" title="Connecting AMPL to MySQL"
             >previous</a> |</li>
        <li><a href="../index.html">AMPL</a> &raquo;</li>
          <li><a href="index.html" >Database and spreadsheet connection guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012 AMPL Optimization, Inc.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>